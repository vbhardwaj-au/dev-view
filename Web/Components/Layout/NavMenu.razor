@using Web.Services
@inject AuthService Auth
@inject NavigationManager Nav

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">DevView</a>
    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />

<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    <nav class="nav flex-column">
        <AuthorizeView>
            <Authorized>
                <div class="nav-item px-2">
                    <div class="user-info">
                        <i class="bi bi-person-circle"></i>
                        <span class="user-name">@context.User.Identity?.Name</span>
                    </div>
                </div>
                <hr class="text-light my-1" />
            </Authorized>
            <NotAuthorized>
                <div class="nav-item px-2">
                    <NavLink class="nav-link" href="login">
                        <i class="bi bi-box-arrow-in-right"></i>
                        <span>Login</span>
                    </NavLink>
                </div>
            </NotAuthorized>
        </AuthorizeView>
        
        <!-- Only show menu items when authenticated -->
        <AuthorizeView>
            <Authorized>
                <!-- Dashboard Group -->
                <div class="nav-item px-2">
                    <div class="nav-link dropdown-toggle" data-bs-toggle="collapse" data-bs-target="#dashboardSubmenu" aria-expanded="true" aria-controls="dashboardSubmenu" style="cursor: pointer;">
                        <i class="bi bi-speedometer2"></i>
                        <span>Dashboard</span>
                    </div>
                    <div class="collapse show" id="dashboardSubmenu">
                        <div class="nav-item ps-3">
                            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                                <i class="bi bi-house-door"></i>
                                <span>Main</span>
                            </NavLink>
                        </div>
                        <div class="nav-item ps-3">
                            <NavLink class="nav-link" href="user-dashboard">
                                <i class="bi bi-git"></i>
                                <span>Commits</span>
                            </NavLink>
                        </div>
                        <div class="nav-item ps-3">
                            <NavLink class="nav-link" href="pr-dashboard">
                                <i class="bi bi-diagram-2"></i>
                                <span>PR</span>
                            </NavLink>
                        </div>
                    </div>
                </div>

                <hr class="text-light my-1" />

                <!-- Data Views Section -->
                <div class="nav-item px-2">
                    <NavLink class="nav-link" href="commits">
                        <i class="bi bi-git"></i>
                        <span>Commits</span>
                    </NavLink>
                </div>

                <div class="nav-item px-2">
                    <NavLink class="nav-link" href="pull-requests">
                        <i class="bi bi-diagram-2"></i>
                        <span>Pull Requests</span>
                    </NavLink>
                </div>

                <div class="nav-item px-2">
                    <NavLink class="nav-link" href="top-committers">
                        <i class="bi bi-trophy"></i>
                        <span>Top Committers</span>
                    </NavLink>
                </div>

                <div class="nav-item px-2">
                    <NavLink class="nav-link" href="teams">
                        <i class="bi bi-people-fill"></i>
                        <span>Teams</span>
                    </NavLink>
                </div>
            </Authorized>
        </AuthorizeView>

        <!-- Admin Section - Only visible to Admin role -->
        <AuthorizeView Roles="Admin">
            <Authorized>
                <div class="nav-item px-2">
                    <div class="nav-link dropdown-toggle" data-bs-toggle="collapse" data-bs-target="#adminSubmenu" aria-expanded="false" aria-controls="adminSubmenu" style="cursor: pointer;">
                        <i class="bi bi-gear-fill"></i>
                        <span>Admin</span>
                    </div>
                    <div class="collapse" id="adminSubmenu">
                        <div class="nav-item ps-3">
                            <NavLink class="nav-link" href="admin/repositories">
                                <i class="bi bi-folder-fill"></i>
                                <span>Repositories</span>
                            </NavLink>
                        </div>
                        <div class="nav-item ps-3">
                            <NavLink class="nav-link" href="admin/users">
                                <i class="bi bi-people-fill"></i>
                                <span>Bitbucket Users</span>
                            </NavLink>
                        </div>
                        <div class="nav-item ps-3">
                            <NavLink class="nav-link" href="admin/user-management">
                                <i class="bi bi-person-gear"></i>
                                <span>User Management</span>
                            </NavLink>
                        </div>
                        <div class="nav-item ps-3">
                            <NavLink class="nav-link" href="admin/roles">
                                <i class="bi bi-shield-lock"></i>
                                <span>Roles</span>
                            </NavLink>
                        </div>
                        <div class="nav-item ps-3">
                            <NavLink class="nav-link" href="admin/settings">
                                <i class="bi bi-sliders"></i>
                                <span>Settings</span>
                            </NavLink>
                        </div>
                    </div>
                </div>
            </Authorized>
        </AuthorizeView>

        <!-- Logout button at the bottom -->
        <AuthorizeView>
            <Authorized>
                <div class="nav-spacer"></div>
                <hr class="text-light my-1" />
                <div class="nav-item px-2">
                    <button class="nav-link logout-btn" @onclick="HandleLogout">
                        <i class="bi bi-box-arrow-right"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </Authorized>
        </AuthorizeView>
    </nav>
</div>

@code {
    private async Task HandleLogout()
    {
        await Auth.LogoutAsync();
    }
}