@inject NavigationManager Nav
@inject HttpClient Http
@inject ILogger<RedirectToLogin> Logger
@using System.Net.Http.Json

@code {
    protected override async Task OnInitializedAsync()
    {
        // Check if this is first run
        try
        {
            var response = await Http.GetFromJsonAsync<FirstRunResponse>("api/auth/check-first-run");
            if (response?.IsFirstRun == true)
            {
                // Redirect to setup page for first-time setup
                Nav.NavigateTo("/setup", forceLoad: false);
                return;
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error checking first run status");
            // If there's an error, proceed to login
        }

        // Normal flow - redirect to login
        var currentUri = Nav.Uri;
        
        if (!currentUri.EndsWith("/login", StringComparison.OrdinalIgnoreCase))
        {
            Nav.NavigateTo("/login", forceLoad: false);
        }
    }

    private class FirstRunResponse
    {
        public bool IsFirstRun { get; set; }
    }
}


